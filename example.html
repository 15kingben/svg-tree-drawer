<!--
@todo: Get compressor that will make URLs short enough. LZ77? Different LZW?
-->
<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf8>
		<title>SVG Tree Drawer Example</title>
		<script src="svgweb/src/svg-uncompressed.js" data-path="svgweb/src"></script>
		<script src="svg-tree-drawer.js"></script>
		<script src="json2.js"></script>
		<script src="example.js"></script>
		<style>
		object {
			outline:solid 1px red;
		}
		</style>
	</head>
	<body>
		<h1>SVG Tree Drawer Example</h1>
		<p>
			Examples:
			<a href="#eyJyb290Ijp7ImxhYmVsIjoiUyIsImNvbGxhcHNlZCI6ZmFsc2UsImNoaWxkcmVuIjpbYCBBJU5QYCA+KXRydWAgMzNEYCBMRVRoZWAhMC59XX0sYCEvJk9NYCE8RmAhaEVib3lgISYxXWAhMilWYCIwRVZgIyZFcGxheXNgISU2YCQ+IVN0eWxlIjp7ImZvbnRTaXplIjoxNSwiZG9taW5hbnRCYXNlbGluZSI6Im1pZGRsZSIsInRleHRBbmNob3JgIConcGFkZGluZ1RvcCI6MTBgICckTGVmdGAgJChCb3R0b21gIDcoUmlnaGAgQCB9LCJicmFuY2hgIU0kaGVgIDUiNSwic3Ryb2tlV2lkdGgiOjJgICgjIjoicmVkIn19">one</a>,
			<a href="#eyJyb290Ijp7ImxhYmVsIjoiUyIsImNvbGxhcHNlZCI6ZmFsc2UsImNoaWxkcmVuIjpbYCBBJU5QYCA+KXRydWAgMzNEYCBMRVRoZWAhMC59XX0sYCEvJk9NYCE8RmAhaEVib3lgISYxXWAhMilWYCIwRVZgIyZFcGxheXNgISU2YCQ+IVN0eWxlIjp7ImZvbnRTaXplIjozNSwiZG9taW5hbnRCYXNlbGluZSI6Im1pZGRsZSIsInRleHRBbmNob3JgIConcGFkZGluZ1RvcCI6MTBgICckTGVmdGAgJChCb3R0b21gIDcoUmlnaGAgQCB9LCJicmFuY2hgIU0kaGVgIDYhMzUsInN0cm9rZVdpZHRoIjoyYCAoIyI6ImJsdWUifX0=">two</a>,
			<a href="#eyJyb290Ijp7ImxhYmVsIjoiUyIsImNvbGxhcHNlZCI6ZmFsc2UsImNoaWxkcmVuIjpbYCBBJU5QYCA+KXRydWAgMzNEYCBMRVRoZWAhMC59XX0sYCEvJk9NYCE8RmAhaEVib3lgISYxXWAhMilWYCIwRVZgIyZFcGxheXNgISU2YCQ+IVN0eWxlIjp7ImZvbnRTaXplIjoyNSwiZG9taW5hbnRCYXNlbGluZSI6Im1pZGRsZSIsInRleHRBbmNob3JgIConcGFkZGluZ1RvcCI6MTBgICckTGVmdGAgJChCb3R0b21gIDcoUmlnaGAgQCB9LCJicmFuY2hgIU0kaGVgIDYhMjUsInN0cm9rZVdpZHRoIjoyYCAoIyI6ImJsYWNrIn19">three</a>
		</p>
		
		<div id="treeContainer">
			<p><em>Please waitâ€¦</em></p>
		</div>
		
		<script>
		//obj.setAttribute('data', 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg"></svg>');
		
		
		var data = {
			//
			root: {
				label:'S',
				children:[
					{
						label:'NP',
						children:[
							{
								label:'D',
								children:[
									{
										label:'The'
									}
								]
							},
							{
								label:'NOM',
								children:[
									{
										label:'N',
										children:[
											{
												label:'boy'
											}
										]
									}
								],
								collapsed:false
							}
						],
						collapsed:true
					},
					{
						label:'VP',
						children:[
							{
								label:'V',
								children:[
									{
										label:"plays"
									}
								],
								collapsed:false
							}
						],
						collapsed:true
					}
				],
				collapsed:false
			}
		};
		
		/**
		 * Get tree data that has been saved in location.hash
		 */
		function parseHash(){
			var hash = window.location.hash.substr(1);
			if(hash){
				try {
					var toParse = decode64(hash);
					var hashdata;
					try {
						hashdata = JSON.parse(toParse);
					}
					//Try decompressing the hash just in case that's why it failed to parse
					catch(e){
						hashdata = JSON.parse(decompress(toParse))
					}
					if(hashdata)
						return hashdata;
				}
				catch(e){
					console.warn(toParse)
				}
			}
			return null;
		}
		
		
		var tree;
		window.addEventListener('load', function(){
			var container = document.getElementById('treeContainer');
			try {
				container.innerHTML = '';
				
				//Get the saved tree data from the location.hash
				var hashData = parseHash();
				if(hashData)
					data = hashData;
				
				tree = new TreeDrawer(container, data.root, data.labelStyle, data.branchStyle);
			}
			catch(e){
				container.innerHTML = '<em style="color:red">Unable to initialize SVG Tree: ' + e.message + '.</em>';
			}
			
				
			//Watch for change in location.hash and
			function monitorBookmark(e){
				if(e && e.type)
					clearInterval(interval);
				var data = parseHash();
				if(data){
					if(data.labelStyle)
						tree.labelStyle = data.labelStyle;
					if(data.branchStyle)
						tree.branchStyle = data.branchStyle;
					if(data.root)
						tree.populate(data.root);
				}
			}
			window.addEventListener('hashchange', monitorBookmark, false);
			var prevHash = location.hash;
			var interval = setInterval(function(){
				if(location.hash != prevHash){
					prevHash = location.hash;
					monitorBookmark();
				}
			}, 100)
			
		}, false);
		
		function bookmarkTree(){
			var hash = encode64(
				compress(
					JSON.stringify({root:tree.root, labelStyle:tree.labelStyle, branchStyle:tree.branchStyle})
				, MaxWindowLength)
			);
			window.location.hash = hash;
		}
		
		//console.info(JSON.stringify(data))
		</script>
		
		<fieldset style="position:absolute; right:10px ; bottom: 10px;">
			<p>
				Branch color:
				<button type="button" onclick="tree.branchStyle.stroke = 'black'; tree.draw();" style='color:black;'>black</button>
				<button type="button" onclick="tree.branchStyle.stroke = 'red'; tree.draw();" style='color:red;'>red</button>
				<button type="button" onclick="tree.branchStyle.stroke = 'blue'; tree.draw();" style='color:blue;'>blue</button>
			</p>
			<p>
				Font size:
				<button type="button" onclick="tree.labelStyle.fontSize = 15; tree.draw();" style='font-size:15px;'>15px</button>
				<button type="button" onclick="tree.labelStyle.fontSize = 25; tree.draw();" style='font-size:25px;'>25px</button>
				<button type="button" onclick="tree.labelStyle.fontSize = 35; tree.draw();" style='font-size:35px;'>35px</button>
			</p>
			<p>
				Branch height:
				<button type="button" onclick="tree.branchStyle.height = 15; tree.draw();" style='height:15px;'>15px</button>
				<button type="button" onclick="tree.branchStyle.height = 25; tree.draw();" style='height:25px;'>25px</button>
				<button type="button" onclick="tree.branchStyle.height = 35; tree.draw();" style='height:35px;'>35px</button>
			</p>
			<p><button type="button" onclick="bookmarkTree()">Save Tree to location hash</button></p>
		</fieldset>
		
		
		<!--
				<svg
				   xmlns="http://www.w3.org/2000/svg"
				   xmlns:xlink="http://www.w3.org/1999/xlink"
				   version="1.1" baseProfile="full"
				   style="border:solid 1px red;"
				   width="200"
				   height="200">
				   
					<rect x="25" y="25" 
							  id="myRect" 
							  rx="0.6" ry="0.6" 
							  width="150" height="150" 
							  fill="green" 
							  stroke="yellow" stroke-width="8"/>
					
				</svg>
		-->
		<hr>
		<footer>
			<address><a href="http://weston.ruter.net/" rel="author">Weston Ruter</a></address>
		</footer>
	</body>
</html>