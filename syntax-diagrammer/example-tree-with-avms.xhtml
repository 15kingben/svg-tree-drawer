<!DOCTYPE html>
<?xml-stylesheet href="hpsg-mathml.xslt?2" type="text/xsl" ?>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset='utf8' />
		<meta http-equiv="X-UA-Compatible" content="chrome=1" />
		<title>Example Phrase Structure Tree with AVMs</title>
		
		<script>
		if(!window.console){
			var console = {
				info:function(){},
				error:function(){},
				warn:function(){}
			}
		}
		</script>
		<script src="../svg-tree-drawer.js?2"></script>
		<style>
		svg foreignObject > *,
		svg text {
			padding:0.5em;
			padding-left:1em;
			padding-right:1em;
		}
		svg foreignObject {
			cursor:pointer;
		}
		svg foreignObject,
		svg polyline,
		svg text {
			font-size:14px !important;
		}
		svg polyline {
			fill:none;
			font-size:3em;
		}
		svg text {
			padding-left:0.5ex !important;
			padding-right:0.5ex !important;
		}
		.treeNode {
			display:inline-block; /*each div wraps a math element, and inline block so we can get offsetHeight and offsetWidth*/
		}
		body.no-colors #treeTheySeemedCloseToMe * {
			color:black !important;
			background:transparent !important;
			border-color:black !important;
		}
		#toggleColorsBtn.off {
			color:red;
		}
		#toggleColorsBtn.on {
			color:green;
		}

		svg g.collapsed g text {
			padding-left:0.5ex;
			padding-right:0.5ex;
		}
		</style>
		<script>
		document.addEventListener('DOMContentLoaded', function(){
			document.getElementById('toggleColorsBtn').addEventListener('click', function(e){
				var body = document.getElementsByTagName('body')[0];
				if(body.className.indexOf('no-colors') == -1){ //colors turned off
					this.innerHTML = "Turn Colors On";
					this.className = 'on';
					body.className += ' no-colors';
				}
				else {
					this.innerHTML = "Turn Colors Off";
					this.className = 'off';
					body.className = body.className.replace(/\s*no-colors/, '');
				}
				//treeTheySeemedCloseToMe
			}, false)
		}, false);
		</script>
	</head>
	<body class='no-colors'>
		<h1>Example Phrase Structure Tree with <abbr title="Attribute Value Matrix">AVM</abbr> Nodes</h1>
		
		<p>This example demonstrates the functionality of the <a href="http://github.com/westonruter/svg-tree-Drawer">SVG Tree Drawer</a>.
		What follows is the phrase structure tree of “They appeared close to
		me.” <strong>You must have Firefox 3+ to view this tree
		properly,</strong> because only this browser currently supports both MathML and SVG.
		If you don't have Firefox 3+, see <a href="example-tree-with-avms.pdf">this page printed to PDF</a>.
		Note that the boxed numbers aren't completely refined due to a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=297467" title=" Bug 297467 -  menclose is shown wrong (not implemented)  ">bug</a> in Firefox which will be fixed in 3.6.
		</p>
		
		<p style="color:red"><em>Note:</em> In Firefox 3.6b3 the <code>div</code> within each of
		the <code>foreignObject</code> elements for some reason gets an <code>offsetWidth/Height</code>
		of zero, so those nodes in the tree cannot be sized properly.</p>
		
		<p>
			<button id="toggleColorsBtn" class="on">Turn Colors On</button>
			<small><samp>Click</samp> on a node to collapse/expand it into a triangle.</small>
			<small><samp>Click+Click</samp> on a node whose children don't have even heights and they will extend down to be the same level.</small>
		</p>
		
		<p id="treeTheySeemedCloseToMe"><em>Tree for “The seemed close to me.” goes here… if it doesn't load, you're probably not using Firefox 3+!</em></p>
		<!-- TODO: place the following nodes into a UL and then automatically derive the tree! -->
		
		<div class="treeNode" id="S">
		<avm type="phrase" xmlns="http://weston.ruter.net/ns/hpsg">
			<attr name="HEAD" tag="1" />
			<attr name="VAL">
				<avm>
					<attr name="COMPS"><list /></attr>
					<attr name="SPR"><list /></attr>
				</avm>
			</attr>
		</avm>
		</div>
		
			<div class="treeNode" id="N_they">
			<avm tag="2" type="phrase" xmlns="http://weston.ruter.net/ns/hpsg">
				<attr name="HEAD">
					<avm type="noun">
						<attr name="AGR" tag="3" />
					</avm>
				</attr>
				<attr name="VAL">
					<avm>
						<attr name="COMPS"><list /></attr>
						<attr name="SPR"><list /></attr>
					</avm>
				</attr>
			</avm>
			</div>
			
			<div class="treeNode" id="VP_appearedCloseToMe" >
			<avm type="phrase" xmlns="http://weston.ruter.net/ns/hpsg">
				<attr name="HEAD">
					<avm type="verb" tag="1">
						<attr name="AGR" tag="3" />
					</avm>
				</attr>
				<attr name="VAL">
					<avm tag="4">
						<attr name="COMPS"><list /></attr>
						<attr name="SPR">
							<list><avm tag="2" /></list>
						</attr>
					</avm>
				</attr>
			</avm>
			</div>
			
				<div class="treeNode" id="V_appeared">
				<avm type="word" xmlns="http://weston.ruter.net/ns/hpsg">
					<attr name="HEAD">
						<avm tag="1" type="verb">
							<attr name="AGR">
								<avm type="plural">
									<attr name="NUM">pl</attr>
									<attr name="PER">3rd</attr>
								</avm>
							</attr>
						</avm>
					</attr>
					<attr name="VAL">
						<avm tag="4">
							<attr name="COMPS">
								<list><avm tag="5" /></list>
							</attr>
							<attr name="SPR">
								<list><avm tag="2" /></list>
							</attr>
						</avm>
					</attr>
				</avm>
				</div>
			
				<div class="treeNode" id="AP_closeToMe">
				<avm tag="5" type="phrase" xmlns="http://weston.ruter.net/ns/hpsg">
					<attr name="HEAD">
						<avm tag="7" type="adj" />
					</attr>
					<attr name="VAL">
						<avm tag="4">
							<attr name="COMPS">
								<list />
							</attr>
							<attr name="SPR">
								<list />
							</attr>
						</avm>
					</attr>
				</avm>
				</div>
			
					<div class="treeNode" id="A_close">
					<avm type="word" xmlns="http://weston.ruter.net/ns/hpsg">
						<attr name="HEAD">
							<avm tag="7" type="adj" />
						</attr>
						<attr name="VAL">
							<avm>
								<attr name="COMPS">
									<list>
										<avm tag="8" />
									</list>
								</attr>
								<attr name="SPR">
									<list />
								</attr>
							</avm>
						</attr>
					</avm>
					</div>
			
					<div class="treeNode" id="PP_toMe">
					<avm tag="8" type="phrase" xmlns="http://weston.ruter.net/ns/hpsg">
						<attr name="HEAD">
							<avm tag="9" type="prep" />
						</attr>
						<attr name="VAL">
							<avm>
								<attr name="COMPS">
									<list />
								</attr>
								<attr name="SPR">
									<list />
								</attr>
							</avm>
						</attr>
					</avm>
					</div>
						
						<div class="treeNode" id="P_to">
						<avm type="word" xmlns="http://weston.ruter.net/ns/hpsg">
							<attr name="HEAD">
								<avm tag="9" type="prep" />
							</attr>
							<attr name="VAL">
								<avm>
									<attr name="COMPS">
										<list>
											<avm tag="10" />
										</list>
									</attr>
									<attr name="SPR">
										<list />
									</attr>
								</avm>
							</attr>
						</avm>
						</div>
				
						<div class="treeNode" id="N_me">
						<avm tag="10" type="word" xmlns="http://weston.ruter.net/ns/hpsg">
							<attr name="HEAD">
								<avm type="noun">
									<attr name="AGR">
										<avm type="1sing">
											<attr name="NUM">sg</attr>
											<attr name="PER">1st</attr>
										</avm>
									</attr>
								</avm>
							</attr>
							<attr name="VAL">
								<avm>
									<attr name="COMPS">
										<list></list>
									</attr>
									<attr name="SPR">
										<list />
									</attr>
								</avm>
							</attr>
						</avm>
						</div>
		
		<script>
		//<![CDATA[
		window.addEventListener('load', function(){
			var $ = function(id){ return document.getElementById(id) || id; };
			
			var tree = new TreeDrawer('treeTheySeemedCloseToMe',
				{label:$('S'), extended:false, children:[
					{label:$('N_they'), children:[
						{label: 'They'}
					]},
					{label:$('VP_appearedCloseToMe'), extended:true, children:[
						{label:$('V_appeared'), children:[
							{label:'seemed'}
						]},
						{label:$('AP_closeToMe'), collapsed:true, children:[
							{label:$('A_close'), children:[
								{label:'close'}
							]},
							{label:$('PP_toMe'), children:[
								{label:$('P_to'), children:[
									{label:'to'}
								]},
								{label:$('N_me'), children:[
									{label:'me'}
								]}
							]}
						]}
					]}
				]}
			);
			//tree.addFilter('label', function(label, treeNode){
			//	if(typeof label == 'string'){
			//		label = label.replace(/seemed/, 'appeared');
			//	}
			//	return label;
			//});
			
			
			//tree.draw(); //refresh
			
			document.getElementsByTagName('svg')[0].addEventListener('click', function(e){
				try {
				var g = e.target;
				//console.warn(g)
				while(g && g.nodeName.toLowerCase() != 'g'){
					g = g.parentNode;
				}
				if(g && g.svgTreeDrawerNode){
					
					if(!e.shiftKey){
						g.svgTreeDrawerNode.collapsed = !g.svgTreeDrawerNode.collapsed;
					}
					else {
						g.svgTreeDrawerNode.extended = !g.svgTreeDrawerNode.extended;
					}
					tree.draw();
				}
				}
				catch(e){
					//alert(e + "at " + e.lineNumber)
					alert(JSON.stringify(e));
				}
				
				//console.info(this)
			}, false);
			
			
			
			tree.draw();
			//window.setTimeout(function(){
			//	for each(fo in document.querySelectorAll('foreignObject')){
			//		if(fo.setAttribute){
			//			fo.setAttribute('width', 1);
			//			fo.setAttribute('height', 1);
			//			labelRect = TreeDrawer._getElementDimensions(fo.firstChild);
			//			fo.setAttribute('width', labelRect.width);
			//			fo.setAttribute('height', labelRect.height);
			//		}
			//	}
			//	window.setTimeout(function(){
			//		tree.draw(true);
			//	}, 500);
			//	//alert(document.querySelectorAll('foreignObject > div').getBoundingClientRect().width)
			//}, 100);
		}, false);
		
		//]]>
		</script>
		
		
		<hr />
		<footer>
			<address><a href="http://weston.ruter.net/" rel="author">Weston Ruter</a></address>
			<time pubdate="">2009-11-19</time>
		</footer>
	</body>
</html>
